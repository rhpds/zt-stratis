== Create a snapshot

A snapshot of a filesystem is a read/writeable thinly provisioned point
in time copy of the source filesystem. To create a snapshot, you will
need the name of the pool in which the filesystem is located, the name
of the filesystem, and the name of the snapshot of the filesystem.

Create a snapshot of the filesystem. Name the snapshot `+my_snapshot+`.

[source,bash,run]
----
sudo stratis filesystem snapshot my_pool my_fs my_snapshot
----

Check that the snapshot was created successfully by listing the stratis
filesystems.

[source,bash,run]
----
stratis fs
----

.snapshot
image::../assets/images/snapshotlist.png[snapshot]

You should see my_snapshot listed in the output.

== Access the snapshot to recover files

Here is an example of how a snapshot can be used to recover deleted
files from a filesystem.

Delete the first file that you created in the previous step.

[source,bash,run]
----
sudo rm -f /mnt/test_mnt/my_first_file
----

Check that `my_first_file`` has been deleted.

[source,bash,run]
----
ls /mnt/test_mnt
----

.rm first file
image::../assets/images/removefirstfile.png[rm first file]

You can see that `+my_first_file+` has been removed from the directory,
and only `+my_second_file+` remains.

You can now mount the snapshot and get access to both files, since the
snapshot was created before the file was deleted. First, create a new
mountpoint to attach the snapshot into the filesystem,
`+/mnt/test_mnt_snap+`.

[source,bash,run]
----
sudo mkdir /mnt/test_mnt_snap
----

Next, mount the snapshot, `+my_snapshot+`.

[source,bash,run]
----
sudo mount /dev/stratis/my_pool/my_snapshot /mnt/test_mnt_snap
----

Confirm that the snapshot was mounted successfully.

[source,bash,run]
----
mount
----

.mounted snapshot
image::../assets/images/mountedsnapshot.png[mounted snapshot]

From the output above, the snapshot is mounted on
`+/mnt/test_mnt_snap+`.

List the files stored within the snapshot on `+/mnt/test_mnt_snap+`.

[source,bash,run]
----
ls /mnt/test_mnt_snap
----

.list snapshot contents
image::../assets/images/listsnapshotcontents.png[list snapshot contents]

Both files are listed!

Copy the file back to the original filesystem
=============================================

Now that you have access to the previously deleted file,
`+my_first_file+`, you may want to copy it back into the original
filesystem, `+my_fs+`.

To do this, copy the file, `+my_first_file+` back into the original
filesytem.

[source,bash,run]
----
sudo cp /mnt/test_mnt_snap/my_first_file /mnt/test_mnt
----

Lastly, confirm that `+my_first_file+` has been copied to
`+/mnt/test_mnt+`.

[source,bash,run]
----
ls /mnt/test_mnt
----

.copied back
image::../assets/images/copiedback.png[copied back]

The filesystem, `+my_fs+`, now contains the previously deleted file,
`+my_first_file+`.
